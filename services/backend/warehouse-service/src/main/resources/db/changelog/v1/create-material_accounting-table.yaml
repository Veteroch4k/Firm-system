databaseChangeLog:
  - changeSet:
      id: create-material_accounting-table
      author: Veteroch4k
      changes:
        - sql:
            sql: "CREATE TYPE act_status AS ENUM('INCOME', 'OUTCOME', 'TRANSFER')"
            dbms: postgresql
        - createTable:
            tableName: materials_accounting
            columns:
              - column: {name: id, type: BIGINT, autoIncrement: true, constraints: {primaryKey: true, nullable: false}}
              - column: {name: material_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: quantity, type: INT, constraints: {nullable: false}}
              - column: {name: type, type: act_status, constraints: {nullable: false}}
              - column: {name: factory_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: employer_id, type: BIGINT, constraints: {nullable: false}}
              - column: {name: date, type: DATE, constraints: {nullable: false}}

        - addForeignKeyConstraint:
            baseTableName: materials_accounting
            baseColumnNames: material_id
            referencedTableName: material
            referencedColumnNames: id
            constraintName: fk_material_accounting_material

        # ИНДЕКСЫ:
        - createIndex:
            tableName: materials_accounting
            columns:
              - column: { name: factory_id }      #  поиск
              - column: { name: date, descending: true }  # сортировка
              - column: { name: id, descending: true }    # для стабильности
            indexName: idx_mat_acc_factory_date

        - createIndex:
            tableName: materials_accounting
            columns:
              - column: { name: material_id }     # поиск
              - column: { name: date, descending: true }  # сортировка
            indexName: idx_mat_acc_material_date

        - createIndex:
            tableName: materials_accounting
            columns:
              - column: { name: date, descending: true } # поиск
              - column: { name: id, descending: true } # сортировка
            indexName: idx_mat_acc_date_global